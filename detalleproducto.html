<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Detalle de Producto | Mundo Franchi</title>
  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Tipografía -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --naranja: #ffe600;
      --negro: #111;
      --gris-claro: #f4f4f4;
      --gris-oscuro: #666;
      --blanco: #fff;
      --font-base: 'Montserrat', sans-serif;
      --border-radius: .5rem;
      --transition: .3s ease-in-out;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: var(--font-base);
      background: var(--gris-claro);
      color: var(--negro);
      line-height:1.5;
    }
    a { text-decoration:none; color:inherit; }
    img { display:block; width:100%; }

    /* NAVBAR NUEVO TIPO MERCADO LIBRE */
    .navbar {
      padding: 0.75rem 1rem;
      font-family: 'Montserrat', sans-serif;
      z-index: 1000;
    }
    .navbar input.form-control {
      height: 45px;
      font-size: 0.95rem;
    }
    .navbar .btn-light {
      height: 45px;
    }
    .navbar .bi {
      vertical-align: middle;
    }


    /* DETALLE PRODUCTO */
    .detalle-container { padding:4rem 2rem; background: var(--blanco); border-radius: var(--border-radius); margin:2rem auto; max-width:1200px; }
    .detalle-titulo { font-size:2.2rem; font-weight:700; margin-bottom:.5rem; }
    .detalle-marca { color: var(--gris-oscuro); margin-bottom:1.5rem; font-style:italic; }
    .detalle-precio {
      font-size:2rem; font-weight:700;
      color: var(--naranja); margin-bottom:1.5rem;
    }
    .detalle-carac { margin-bottom:2rem; color: var(--gris-oscuro); }

    /* Carousel principal */
    #carouselDetalle {
      border-radius: var(--border-radius);
      overflow: hidden;
      background: var(--gris-claro);
    }
    #carouselDetalle .carousel-item img {
      height:400px; object-fit:contain;
      background: var(--blanco);
      transition: transform var(--transition);
    }
    #carouselDetalle .carousel-item.active img {
      transform: scale(1.02);
    }
    /* Thumbnails */
    .thumbs {
      display:flex; justify-content:center;
      gap:1rem; margin-top:1rem;
    }
    .thumbs img {
      width: 80px; height:80px;
      object-fit:cover;
      border:2px solid transparent;
      border-radius: var(--border-radius);
      cursor:pointer;
      transition: border var(--transition);
    }
    .thumbs img.active {
      border-color: var(--naranja);
    }

    /* Botones */
    .btn-compra {
      background: var(--naranja);
      color: var(--negro);
      font-weight:600;
      padding:.75rem;
      border-radius: var(--border-radius);
      transition: background var(--transition), transform var(--transition);
    }
    .btn-compra:hover {
      background: #db500f;
      transform: translateY(-2px);
    }
    .btn-carrito {
      border:2px solid var(--naranja);
      color: var(--naranja);
      font-weight:600;
      padding:.75rem;
      border-radius: var(--border-radius);
      transition: background var(--transition), color var(--transition);
    }
    .btn-carrito:hover {
      background: var(--naranja);
      color: var(--negro);
    }

    /* Info extra */
    .detalle-info li {
      margin-bottom:.75rem;
      display:flex; align-items:center;
      color: var(--gris-oscuro);
    }
    .detalle-info li i {
      font-size:1.25rem;
      color: var(--naranja);
      margin-right:.5rem;
    }

    /* Pestañas adicionales */
    #detalle-tabs .nav-pills .nav-link {
      border-radius: var(--border-radius);
      margin:0 .5rem;
      font-weight:600;
      color: var(--gris-oscuro);
      transition: background var(--transition), color var(--transition);
    }
    #detalle-tabs .nav-pills .nav-link.active {
      background: var(--naranja);
      color: var(--negro);
    }
    #detalle-tabs .tab-content {
      background: var(--blanco);
      padding:2rem;
      border-radius: var(--border-radius);
      box-shadow:0 4px 12px rgba(0,0,0,0.05);
      margin-top:1rem;
    }
    #detalle-tabs table th {
      width:200px;
      font-weight:600;
      color: var(--gris-oscuro);
    }

    /* FOOTER */
    footer {
      background: var(--negro);
      color: var(--gris-claro);
      padding:2rem;
      margin-top:2rem;
    }
    footer h5 { font-weight:600; margin-bottom:.5rem; }
    footer a { color: var(--naranja); transition: color var(--transition); }
    footer a:hover { color: var(--blanco); }
    /* 🔍 Estilo PRO para resultados de búsqueda */
    #searchResults {
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 10px 10px;
      max-height: 400px;
      overflow-y: auto;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      z-index: 9999;
    }

    .search-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 12px 16px;
      border-bottom: 1px solid #f1f1f1;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .search-item:hover {
      background: #f9f9f9;
    }

    .search-item img {
      width: 48px;
      height: 48px;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid #ddd;
      background: #fff;
    }

    .search-item-info {
      flex: 1;
    }

    .search-item-info h6 {
      margin: 0;
      font-size: 15px;
      font-weight: 600;
      color: #111;
      line-height: 1.2;
    }

    .search-item-info .price {
      font-size: 14px;
      font-weight: 600;
      color: #1b5e20;
      margin-top: 4px;
    }

  </style>
</head>
<body>

  <!-- NAVBAR -->
  <!-- NAVBAR ESTILO MERCADO LIBRE -->
  <nav class="navbar navbar-expand-lg shadow-sm" style="background-color: #ffe600;">
    <div class="container align-items-center">
      <a class="navbar-brand d-flex align-items-center" href="/index.html">
        <img src="./logo6.png" alt="Logo" style="height: 75px;">
      </a>
      <form class="d-flex flex-grow-1 mx-3 position-relative">
        <input id="searchInput" class="form-control rounded-start border-0 shadow-sm" type="search" placeholder="Buscar productos, marcas y más..." aria-label="Search" autocomplete="off">
        <button class="btn btn-light border-start-0 rounded-end" type="submit"><i class="bi bi-search"></i></button>
        <div id="searchResults" class="position-absolute bg-white shadow rounded mt-1 w-100 z-3 d-none" style="top: 100%; max-height: 300px; overflow-y: auto;"></div>
      </form>
      <div class="d-flex align-items-center gap-3">
        <a href="#" class="text-dark fw-semibold text-decoration-none">Categorías</a>
        <a href="#" class="text-dark"><i class="bi bi-person fs-5"></i></a>
        <a href="#" class="text-dark"><i class="bi bi-cart fs-5"></i></a>
      </div>
    </div>
  </nav>

  <!-- DETALLE PRODUCTO -->
  <section class="detalle-container container">
    <div class="row gx-5">
      <!-- Imágenes -->
      <div class="col-lg-7">
        <div id="carouselDetalle" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner" id="carousel-detalle-inner"></div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselDetalle" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselDetalle" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
          </button>
        </div>
        <div class="thumbs" id="detalle-thumbs"></div>
      </div>

      <!-- Información básica -->
      <div class="col-lg-5">
        <h1 class="detalle-titulo" id="detalle-titulo"></h1>
        <div class="detalle-marca" id="detalle-marca"></div>
        <div class="detalle-precio" id="detalle-precio"></div>
        <p class="detalle-carac" id="detalle-caracteristica"></p>

        <div class="d-grid gap-2 mb-4">
          <button id="btn-comprar" class="btn-compra">Comprar ahora</button>
          <button id="btn-carrito" class="btn-carrito">Agregar al carrito</button>
        </div>

        <ul class="detalle-info list-unstyled">
          <li><i class="bi bi-credit-card-fill"></i> 6 cuotas sin interés</li>
          <li><i class="bi bi-truck"></i> Envíos gratis a todo el país</li>
          <li><i class="bi bi-shield-check"></i> Garantía oficial de hasta 36 meses</li>
          <li><i class="bi bi-headset"></i> Soporte 24/7</li>
        </ul>
      </div>
    </div>

    <!-- PESTAÑAS ADICIONALES -->
    <div id="detalle-tabs" class="mt-5">
      <ul class="nav nav-pills justify-content-center" id="pills-tab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="pills-desc-tab" data-bs-toggle="pill"
                  data-bs-target="#pills-desc" type="button" role="tab">Descripción</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="pills-benef-tab" data-bs-toggle="pill"
                  data-bs-target="#pills-benef" type="button" role="tab">Beneficios</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="pills-about-tab" data-bs-toggle="pill"
                  data-bs-target="#pills-about" type="button" role="tab">Sobre Nosotros</button>
        </li>
      </ul>
      <div class="tab-content" id="pills-tabContent">
        <!-- Descripción -->
        <div class="tab-pane fade show active" id="pills-desc" role="tabpanel">
          <p id="detalle-descripcion" class="text-justify"></p>
        </div>
        <!-- Especificaciones -->
        <div class="tab-pane fade" id="pills-especs" role="tabpanel">
          <table class="table table-striped">
            <tbody>
              <tr><th>Código</th><td id="spec-codigo"></td></tr>
              <tr><th>Costo</th><td id="spec-costo"></td></tr>
              <tr><th>Ganancia</th><td id="spec-ganancia"></td></tr>
              <tr><th>6 CSI + csi_cem</th><td id="spec-csi"></td></tr>
              <tr><th>csi_cem</th><td id="spec-csi_cem"></td></tr>
            </tbody>
          </table>
        </div>
        <!-- Beneficios -->
        <div class="tab-pane fade" id="pills-benef" role="tabpanel">
          <ul class="list-unstyled">
            <li><i class="bi bi-check-circle-fill text-primary me-2"></i>6 cuotas sin interés</li>
            <li><i class="bi bi-check-circle-fill text-primary me-2"></i>Envíos gratis a todo el país</li>
            <li><i class="bi bi-check-circle-fill text-primary me-2"></i>Garantía oficial de hasta 36 meses</li>
            <li><i class="bi bi-check-circle-fill text-primary me-2"></i>Atención personalizada 24/7</li>
          </ul>
        </div>
        <!-- Sobre Nosotros -->
        <div class="tab-pane fade" id="pills-about" role="tabpanel">
          <h3>Quiénes Somos</h3>
          <p>Mundo Franchi es la ferretería online líder en Argentina, con más de 20 años dedicados a ofrecer herramientas profesionales de las mejores marcas.</p>
          <p>Nuestra misión: llevar calidad y confianza a tu proyecto, con envío rápido y atención 24/7.</p>
          <p>Visita nuestras redes para enterarte de las últimas promos y contenido exclusivo.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="container">
      <div class="row gy-4 text-center text-md-start">
        <div class="col-md-4">
          <h5>Mundo Franchi</h5>
          <p>Distribuidor oficial de herramientas profesionales en Argentina.</p>
        </div>
        <div class="col-md-4">
          <h5>Contacto</h5>
          <p>📞 11 2233 4455<br>📧 info@mundofranchi.com</p>
        </div>
        <div class="col-md-4">
          <h5>Síguenos</h5>
          <p><a href="#">Instagram</a> | <a href="#">Facebook</a> | <a href="#">WhatsApp</a></p>
        </div>
      </div>
      <div class="text-center mt-4">
        <small>&copy; 2025 Mundo Franchi. Todos los derechos reservados.</small>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDMNJ0tDS1BzMe_0w6JTm_Dm6hV9b096NY",
    authDomain: "mundofranchi-ccdee.firebaseapp.com",
    projectId: "mundofranchi-ccdee",
    storageBucket: "mundofranchi-ccdee.firebasestorage.app",
    messagingSenderId: "7229333965",
    appId: "1:7229333965:web:1a4bcac32780a76b75e484",
    measurementId: "G-T54T45ZBDL"
  };


  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  const searchInput = document.getElementById('searchInput');
  const searchResults = document.getElementById('searchResults');
  let productos = []; // productos cargados desde Firebase
  getDocs(collection(db, "productos")).then(snapshot => {
    productos = [];
    snapshot.forEach(doc => productos.push({ id: doc.id, ...doc.data() }));
  });

  let resultadosBusquedaActual = [];

  if (!id) {
    document.body.innerHTML = '<p class="text-center mt-5">Producto no encontrado.</p>';
    throw '';
  }

  const docRef = doc(db, "productos", id);
  const docSnap = await getDoc(docRef);

  if (!docSnap.exists()) {
    document.body.innerHTML = '<p class="text-center mt-5">Producto no encontrado.</p>';
    throw '';
  }

  const detalle = docSnap.data();
  detalle.id = id;

  // Rellenar datos básicos
  document.getElementById('detalle-titulo').textContent = detalle.producto;
  document.getElementById('detalle-marca').textContent = detalle.marca;
  const precioLista = Math.round(detalle.csi_cem);
  const precioTransferencia = Math.round(detalle.cem);
  const cuota6 = Math.round(precioLista / 6);

  document.getElementById('detalle-precio').innerHTML = `
    <div style="font-size:2rem; font-weight:700; color:#d62828; margin-bottom:.5rem;">
      $${precioLista.toLocaleString()}
    </div>
    <div style="color:#111; font-size:1.1rem; font-weight:600; margin-bottom:.5rem;">
      6 cuotas sin interés de 
      <span style="color:#d62828;">$${cuota6.toLocaleString()}</span>
    </div>
    <div style="font-size:1.1rem; font-weight:700; color:#1b5e20; margin-top:1.5rem;">
      PRECIO TRANSFERENCIA / EFECTIVO
    </div>
    <div style="font-size:1.6rem; font-weight:700; color:#1b5e20;">
      $${precioTransferencia.toLocaleString()}
    </div>
    <div style="font-size:.9rem; color:#555;">
      Descuento pagando en efectivo / transferencia: <strong>41%</strong>
    </div>
  `;

  document.getElementById('detalle-caracteristica').textContent = detalle.caracteristica || '';
  document.getElementById('detalle-descripcion').textContent = detalle.descripcion || detalle.caracteristica || 'Sin descripción disponible.';

  // Carousel y thumbnails
  const imgs = ['imagen1_base64','imagen2_base64','imagen3_base64'].map(k => detalle[k]).filter(Boolean);
  const carouselInner = document.getElementById('carousel-detalle-inner');
  const thumbsContainer = document.getElementById('detalle-thumbs');
  imgs.forEach((b64, idx) => {
    const item = document.createElement('div');
    item.className = 'carousel-item' + (idx===0? ' active':'');
    item.innerHTML = `<img src="data:image/jpeg;base64,${b64}" alt="Imagen ${idx+1}">`;
    carouselInner.appendChild(item);

    const thumb = document.createElement('img');
    thumb.src = `data:image/jpeg;base64,${b64}`;
    if (idx===0) thumb.classList.add('active');
    thumb.addEventListener('click',()=>{
      bootstrap.Carousel.getInstance(document.getElementById('carouselDetalle')).to(idx);
      document.querySelectorAll('.thumbs img').forEach(i=>i.classList.remove('active'));
      thumb.classList.add('active');
    });
    thumbsContainer.appendChild(thumb);
  });

  searchInput.addEventListener('input', () => {
    const search = searchInput.value.toLowerCase();
    if (search === '') {
      resultadosBusquedaActual = [];
      searchResults.classList.add('d-none');
      return;
    }

    resultadosBusquedaActual = productos.filter(prod =>
      prod.producto.toLowerCase().includes(search) ||
      prod.marca?.toLowerCase().includes(search) ||
      prod.caracteristica?.toLowerCase().includes(search)
    );

    renderSearchResults(resultadosBusquedaActual);
  });

  searchInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      e.preventDefault(); // evita envío del form
      if (resultadosBusquedaActual.length > 0) {
        const primero = resultadosBusquedaActual[0];
        window.location.href = `detalleproducto.html?id=${primero.id}`;
      }
    }
  });


  // Especificaciones
  document.getElementById('spec-codigo').textContent = detalle.codigo;
  document.getElementById('spec-costo').textContent = '$' + Math.round(detalle.costo).toLocaleString();
  document.getElementById('spec-ganancia').textContent = '$' + Math.round(detalle.c_ganancia).toLocaleString();
  document.getElementById('spec-csi').textContent = detalle.csi_csi_cem;
  document.getElementById('spec-csi_cem').textContent = detalle.csi_cem;

  // Botones
  document.getElementById('btn-carrito').addEventListener('click',()=>{
    const cart = JSON.parse(localStorage.getItem('carrito')||'[]');
    cart.push(detalle);
    localStorage.setItem('carrito', JSON.stringify(cart));
    alert('✅ Agregado al carrito');
  });

  document.getElementById('btn-comprar').addEventListener('click', () => {
    const cart = JSON.parse(localStorage.getItem('carrito') || '[]');
    cart.push(detalle);
    localStorage.setItem('carrito', JSON.stringify(cart));
    localStorage.setItem('compraInmediata', JSON.stringify(detalle));
    window.location.href = 'finalizarcompra.html';
  });

  function renderSearchResults(productosFiltrados) {
    searchResults.innerHTML = '';
    if (productosFiltrados.length === 0) {
      searchResults.classList.add('d-none');
      return;
    }

    productosFiltrados.slice(0, 10).forEach(prod => {
      const div = document.createElement('div');
      div.className = 'search-item';
      div.onclick = () => {
        window.location.href = `detalleproducto.html?id=${prod.id}`;
      };
      div.innerHTML = `
        <img src="data:image/jpeg;base64,${prod.imagen1_base64}" alt="${prod.producto}">
        <div class="search-item-info">
          <h6>${prod.producto}</h6>
          <div class="price">$${Math.round(prod.csi_cem).toLocaleString()}</div>
        </div>`;
      searchResults.appendChild(div);
    });

    searchResults.classList.remove('d-none');
  }

</script>
</body>
</html>
